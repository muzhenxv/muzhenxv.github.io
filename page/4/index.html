<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="the Home of MuZhen">
<meta property="og:url" content="http://www.muzhen.tk/page/4/index.html">
<meta property="og:site_name" content="the Home of MuZhen">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="the Home of MuZhen">






  <link rel="canonical" href="http://www.muzhen.tk/page/4/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>the Home of MuZhen</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">the Home of MuZhen</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/develepment/elasticsearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/develepment/elasticsearch/" class="post-title-link" itemprop="url">elasticsearch</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/develepment/" itemprop="url" rel="index"><span itemprop="name">develepment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>由于工作原因，需要对爬取下来的新闻进行全文实时检索，简单调研后选择elasticsearch完成该功能。</p>
<h1 id="elasticsearch单机版安装"><a href="#elasticsearch单机版安装" class="headerlink" title="elasticsearch单机版安装"></a>elasticsearch单机版安装</h1><p>选择docker方式进行安装。选择镜像进行拉取</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull daocloud.io<span class="regexp">/library/</span><span class="string">elasticsearch:</span><span class="number">5.4</span><span class="number">.2</span>-alpine</span><br></pre></td></tr></table></figure>
<p>启动容器后台运行</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -<span class="selector-tag">p</span> <span class="number">9200</span>:<span class="number">9200</span> -<span class="selector-tag">p</span> <span class="number">9300</span>:<span class="number">9300</span> -d -e <span class="string">"discovery.type=single-node"</span> --name elasticsearch daocloud.io/library/elasticsearch:<span class="number">5.4</span>.<span class="number">2</span>-alpine</span><br></pre></td></tr></table></figure>
<h1 id="安装python-api操作elasticsearch"><a href="#安装python-api操作elasticsearch" class="headerlink" title="安装python api操作elasticsearch"></a>安装python api操作elasticsearch</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 <span class="keyword">install</span> elasticsearch</span><br></pre></td></tr></table></figure>
<h1 id="python-api-操作说明"><a href="#python-api-操作说明" class="headerlink" title="python api 操作说明"></a>python api 操作说明</h1><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line"># 建立索引，其中news为Type，可以理解为分组，对应<span class="keyword">python</span> api中的arg doc_type，最好一个索引只含有一个<span class="built_in">type</span>。<span class="number">7</span>.<span class="keyword">x</span>版本elasticsearch据说会取消Type。index_mappings为索引所需要保存的json文件的key-value结构，也就是properties中内容。</span><br><span class="line">es = Elasticsearch()</span><br><span class="line">index_mappings = &#123;</span><br><span class="line">    <span class="string">"mappings"</span>: &#123;</span><br><span class="line">        <span class="string">"news"</span>: &#123;</span><br><span class="line">            <span class="string">"properties"</span>: &#123;</span><br><span class="line">                <span class="string">"url"</span>: &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;,</span><br><span class="line">                <span class="string">"title"</span>: &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;,</span><br><span class="line">                <span class="string">"publish"</span>: &#123;<span class="string">"type"</span>: <span class="string">"string"</span>，<span class="string">"index"</span>: <span class="string">"not_analyzed"</span>&#125;,</span><br><span class="line">                <span class="string">"content"</span>: &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> not es.indices.<span class="built_in">exists</span>(<span class="string">'defensenews'</span>):</span><br><span class="line">    es.indices.create(<span class="string">'defensenews'</span>, body=index_mappings)</span><br><span class="line"></span><br><span class="line"># 向索引中插入数据</span><br><span class="line">item = &#123;&#125;</span><br><span class="line">item[<span class="string">'url'</span>] = url</span><br><span class="line">item[<span class="string">'title'</span>] = title</span><br><span class="line">item[<span class="string">'publish'</span>] = publish</span><br><span class="line">item[<span class="string">'content'</span>] = content</span><br><span class="line">es.<span class="built_in">index</span>(<span class="string">'defensenews'</span>, doc_type=<span class="string">'news'</span>, body=item)</span><br><span class="line"></span><br><span class="line"># 全文检索,查询content中包含radar的记录,_source指定需要获取的字段名</span><br><span class="line"><span class="keyword">res</span> = es.<span class="built_in">search</span>(<span class="string">"defensenews"</span>, doc_type=<span class="string">'news'</span>, body=&#123;<span class="string">"query"</span>: &#123;<span class="string">"match"</span>: &#123;<span class="string">"content"</span>: <span class="string">"radar"</span>&#125;&#125;&#125;, _source=[<span class="string">'title'</span>])</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">res</span>)</span><br></pre></td></tr></table></figure>
<p>对于中文，需要安装ik分词插件（该docker中是否已经集成未测试），在index_mappings中需要指定中文分词器，具体见参考链接。</p>
<h1 id="时间类型处理"><a href="#时间类型处理" class="headerlink" title="时间类型处理"></a>时间类型处理</h1><p>elasticsearch会识别一定格式的字符串，并自动将之转为时间类型。</p>
<blockquote>
<p>至于什么样的字符串es会认为可以转换成date类型，参考<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-date-format.html" target="_blank" rel="noopener">elasticsearch官网介绍</a></p>
</blockquote>
<p>kibana在读取es数据时如果数据不带时区信息则会当成零时区，并根据系统时区自动对数据进行时间转换，因此</p>
<blockquote>
<p>所以最佳实践方案就是：我们在往es提交日期数据的时候，直接提交带有时区信息的日期字符串，如：“2016-07-15T12:58:17.136+0800”。</p>
</blockquote>
<h1 id="inferences"><a href="#inferences" class="headerlink" title="inferences"></a>inferences</h1><p><a href="http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html" target="_blank" rel="noopener">全文搜索引擎 Elasticsearch 入门教程</a></p>
<p><a href="http://www.cnblogs.com/yxpblog/p/5141738.html" target="_blank" rel="noopener">python操作Elasticsearch (一、例子)</a></p>
<p><a href="http://rockybean.info/2015/02/27/elasticsearch-date-type" target="_blank" rel="noopener">Elasticsearch Date类型使用技巧</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/develepment/flask&request/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/develepment/flask&request/" class="post-title-link" itemprop="url">flask&request</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/develepment/" itemprop="url" rel="index"><span itemprop="name">develepment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="调用api方法"><a href="#调用api方法" class="headerlink" title="调用api方法"></a>调用api方法</h1><p>参考<a href="http://www.cnblogs.com/GuoYaxiang/p/6232831.html" target="_blank" rel="noopener">Python3使用urllib访问网页</a></p>
<p>利用post请求进行调用</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.someserver.com/cgi-bin/register.cgi'</span></span><br><span class="line">values = &#123;<span class="string">'name'</span> : <span class="string">'Michael Foord'</span>,</span><br><span class="line">          <span class="string">'location'</span> : <span class="string">'Northampton'</span>,</span><br><span class="line">          <span class="string">'language'</span> : <span class="string">'Python'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> = urllib.parse.urlencode(values)</span><br><span class="line"><span class="keyword">data</span> = <span class="keyword">data</span>.encode(<span class="string">'ascii'</span>) # <span class="keyword">data</span> should be bytes</span><br><span class="line">req = urllib.request.Request(url, <span class="keyword">data</span>)</span><br><span class="line"><span class="keyword">with</span> urllib.request.urlopen(req) <span class="keyword">as</span> response:</span><br><span class="line">   the_page = response.read()</span><br></pre></td></tr></table></figure>
<p>如果不传递data参数，就变成利用get请求调用。get请求有长度限制，具体长度好像随着浏览器不同而不同，因此长字符串的传递使用post请求更为合适。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/develepment/flask/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/develepment/flask/" class="post-title-link" itemprop="url">flask</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/develepment/" itemprop="url" rel="index"><span itemprop="name">develepment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br></pre></td></tr></table></figure>
<p>app是Flask的实例。<code>__name__</code>可以使得flask可以找到资源对象。如果以上是一个test.py单脚本，那么<code>__name__==&#39;__main__&#39;</code>，如果它是一个<code>__init__.py</code>文件，那么指向的就是这个package的名字。具体见flask官方文档</p>
<p>将flask放入docker中web服务在外部curl，报curl（56）错误，是因为启动py服务时需要指定host为<code>0.0.0.0</code>， <a href="https://serverfault.com/questions/769578/curl-56-recv-failure-connection-reset-by-peer-when-hitting-docker-container" target="_blank" rel="noopener">curl (56) Recv failure: Connection reset by peer - when hitting docker container</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/develepment/error&solution/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/develepment/error&solution/" class="post-title-link" itemprop="url">error&solution</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/develepment/" itemprop="url" rel="index"><span itemprop="name">develepment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="hexo-exists-Template-render-error"><a href="#hexo-exists-Template-render-error" class="headerlink" title="hexo exists Template render error"></a>hexo exists Template render error</h1><p>在使用<code>hexo g</code>时出现Template render error错误。最后发现是.md文件中一些格式比如\{\{\}\}不被hexo支持解析。</p>
<p>如果不在代码块中，那么直接加转义符形如<code>\{\{\}\</code>即可，在typera中展示时不会出现转义符。</p>
<p>如果是在代码块中，也是通过加上转义符破坏\{\{形式，至于是每个括号都加转义符还是只加一个随意，比如这样<code>{\{}\}</code>。不好的地方是在代码块中会原样展现在typera的预览页面上。</p>
<p><a href="https://github.com/hexojs/hexo/issues/2160" target="_blank" rel="noopener">hexo s failed, generate error</a></p>
<p><a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">Troubleshooting</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/develepment/kibana/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/develepment/kibana/" class="post-title-link" itemprop="url">kibana</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/develepment/" itemprop="url" rel="index"><span itemprop="name">develepment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>kibana是一款开源分析和可视化平台，设计出来用于和Elasticsearch一起使用。</p>
<h1 id="安装kibana"><a href="#安装kibana" class="headerlink" title="安装kibana"></a>安装kibana</h1><p>采用docker方式安装</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> --name mykibana -e <span class="attribute">ELASTICSEARCH_URL</span>=http://&lt;your-ip&gt;:9200 -p 5601:5601 -d daocloud.io/library/kibana:&lt;version&gt;</span><br></pre></td></tr></table></figure>
<p>其中<code>&lt;your-ip&gt;</code>请填写你的elasticsearch服务使用的ip。如果elasticsearch也是通过docker服务启动的，那么可以通过<code>docker inspect --format &#39;{\{.NetworkSettings.IPAddress}\}&#39; container_id</code>命令查看elasticsearch容器对应的ip地址。其中\为转义为了可以被hexo识别，使用命令时可以不打。</p>
<p><code>&lt;version&gt;</code>请和elasticsearch保持一致避免出现问题。我的elasticsearch使用的是daocloud.io/library/elasticsearch：5.4.2-alpine，kibana使用的是daocloud.io/library/kibana：5.4.2。</p>
<h1 id="使用kibana"><a href="#使用kibana" class="headerlink" title="使用kibana"></a>使用kibana</h1><p>chrome通过<code>localhost:5601</code>可以访问kibana。没有错误情况下应该类似下图界面：</p>
<p><img src="http://omdhuynsr.bkt.clouddn.com/17-10-31/35560171.jpg" alt></p>
<p>使用kibana的第一步是配置索引。假设elasticsearch中已经有一个defensenews的索引。那么可以将索引匹配模式的名称写成defense*,由于我的这个索引内没有时间数据，因此取消勾选<code>索引包含时间活动</code>这一选项框。然后点击create创建即可。</p>
<p><img src="http://omdhuynsr.bkt.clouddn.com/17-10-31/77919984.jpg" alt></p>
<p>在网页左侧的Management栏目下，可以看到defense*索引包含的字段及其类型。</p>
<p><img src="http://omdhuynsr.bkt.clouddn.com/17-10-31/29438812.jpg" alt></p>
<p>需要注意，只有具有aggregatable属性的字段才可以进行聚合做图。我的这个索引所有字段类型都是text，因此都无法参与聚合。只需要在创建索引的时候将字段类型定义如下代码中的publish，就可以具有aggregatable属性，更具体的类型设定我没有尝试，请自行挖掘。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">index_mappings = &#123;</span><br><span class="line">    <span class="string">"mappings"</span>: &#123;</span><br><span class="line">        <span class="string">"news"</span>: &#123;</span><br><span class="line">            <span class="string">"properties"</span>: &#123;</span><br><span class="line">                <span class="string">"url"</span>: &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;,</span><br><span class="line">                <span class="string">"title"</span>: &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;,</span><br><span class="line">                <span class="string">"publish"</span>: &#123;<span class="string">"type"</span>: <span class="string">"string"</span>，<span class="string">"index"</span>: <span class="string">"not_analyzed"</span>&#125;,</span><br><span class="line">                <span class="string">"content"</span>: &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="inferences"><a href="#inferences" class="headerlink" title="inferences"></a>inferences</h1><p><a href="http://blog.csdn.net/sbsujjbcy/article/details/52335325" target="_blank" rel="noopener">记一次Docker下安装Logstash+Elasticsearch+Kibana经历</a></p>
<p><a href="http://blog.csdn.net/ming_311/article/details/50619859" target="_blank" rel="noopener">Kibana基本使用</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/develepment/python邮件监控/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/develepment/python邮件监控/" class="post-title-link" itemprop="url">python邮件监控</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/develepment/" itemprop="url" rel="index"><span itemprop="name">develepment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/develepment/scrapy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/develepment/scrapy/" class="post-title-link" itemprop="url">scrapy</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/develepment/" itemprop="url" rel="index"><span itemprop="name">develepment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本篇内容：利用python scrapy爬取某新闻网站新闻，并将新闻存进elasticsearch便于全文检索。</p>
<h1 id="安装scrapy"><a href="#安装scrapy" class="headerlink" title="安装scrapy"></a>安装scrapy</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple scrapy</span><br></pre></td></tr></table></figure>
<h1 id="建立项目"><a href="#建立项目" class="headerlink" title="建立项目"></a>建立项目</h1><h2 id="通过命令行在当前目录新建项目"><a href="#通过命令行在当前目录新建项目" class="headerlink" title="通过命令行在当前目录新建项目"></a>通过命令行在当前目录新建项目</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject tutorial</span><br></pre></td></tr></table></figure>
<h2 id="编写Item类，即实体类"><a href="#编写Item类，即实体类" class="headerlink" title="编写Item类，即实体类"></a>编写Item类，即实体类</h2><p>修改items.py代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类名随意</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DmozItem</span><span class="params">(scrapy.Item)</span>:</span></span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    <span class="comment"># name = scrapy.Field()</span></span><br><span class="line">    url = scrapy.Field()</span><br><span class="line">    title = scrapy.Field()</span><br><span class="line">    publish = scrapy.Field()</span><br><span class="line">    content = scrapy.Field()</span><br></pre></td></tr></table></figure>
<h2 id="编写spider类"><a href="#编写spider类" class="headerlink" title="编写spider类"></a>编写spider类</h2><p>在spiders文件夹下新建dmoz_spider.py文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> scrapy.contrib.linkextractors <span class="keyword">import</span> LinkExtractor</span><br><span class="line"><span class="keyword">from</span> scrapy.contrib.spiders <span class="keyword">import</span> CrawlSpider,Rule</span><br><span class="line"><span class="keyword">from</span> tutorial.items <span class="keyword">import</span> DmozItem</span><br><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span> Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">index_mappings = &#123;</span><br><span class="line">    <span class="string">"mappings"</span>: &#123;</span><br><span class="line">        <span class="string">"news"</span>: &#123;</span><br><span class="line">            <span class="string">"properties"</span>: &#123;</span><br><span class="line">                <span class="string">"url"</span>: &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;,</span><br><span class="line">                <span class="string">"title"</span>: &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;,</span><br><span class="line">                <span class="string">"publish"</span>: &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;,</span><br><span class="line">                <span class="string">"content"</span>: &#123;<span class="string">"type"</span>: <span class="string">"text"</span>&#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> es.indices.exists(<span class="string">'defensenews'</span>):</span><br><span class="line">    es.indices.create(<span class="string">'defensenews'</span>, index_mappings)</span><br><span class="line"><span class="comment"># keywords = ['E-2D', 'E-2C', 'DARPA', 'THAAD', 'SMART-L', 'F-22', 'RADAR']</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DmozSpider</span><span class="params">(CrawlSpider)</span>:</span></span><br><span class="line">    name = <span class="string">"dmoz"</span></span><br><span class="line">    allowed_domains = [<span class="string">"defensenews.com"</span>]</span><br><span class="line">    start_urls = [</span><br><span class="line">        <span class="string">"https://www.defensenews.com"</span></span><br><span class="line">    ]</span><br><span class="line">    rules = [Rule(LinkExtractor(allow=<span class="string">r"/.*/2017/\d+/\d+/.*"</span>), follow=<span class="keyword">True</span>, callback=<span class="string">'parse_item'</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_item</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        url = response.url</span><br><span class="line">        <span class="comment"># 如果item调用下面的实体类，最后得到的item并非字典格式，无法存进es。</span></span><br><span class="line">        <span class="comment"># item = DmozItem()</span></span><br><span class="line">        item = &#123;&#125;</span><br><span class="line">        item[<span class="string">'url'</span>] = [response.url]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = urllib.request.urlopen(url)</span><br><span class="line">            text = response.read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">            title = re.findall(<span class="string">'head col-sm-12.*?&lt;h1&gt;(.*?)&lt;/h1&gt;'</span>, text, re.S)[<span class="number">0</span>]</span><br><span class="line">            publish = \</span><br><span class="line">                re.findall(<span class="string">'publish addthis.*?&lt;/i&gt;(.*?)&lt;/span&gt;'</span>, text,</span><br><span class="line">                           re.S)[<span class="number">0</span>].strip()</span><br><span class="line">            pattern = <span class="string">"""&lt;div class="row"&gt; &lt;div class="col-md-12 col-xs-12 col-print-12"&gt; &lt;p class="element element-paragraph"&gt;(.*?)&lt;/p&gt; &lt;/div&gt; &lt;/div&gt;"""</span></span><br><span class="line">            content = <span class="string">'&lt;br /&gt;'</span>.join(re.findall(pattern, text, re.S))</span><br><span class="line">            item[<span class="string">'title'</span>] = title</span><br><span class="line">            item[<span class="string">'publish'</span>] = publish</span><br><span class="line">            item[<span class="string">'content'</span>] = content</span><br><span class="line">            es.index(<span class="string">'defensenews'</span>, doc_type=<span class="string">'news'</span>, body=item)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
<p>allowed_domains限制域名，start_urls设定起始url，可以多个。</p>
<p>特别注意，类继承的是CrawlSpider，如果只是继承scrapy.Spider,rules无法使用会报错！</p>
<h1 id="爬虫持久化"><a href="#爬虫持久化" class="headerlink" title="爬虫持久化"></a>爬虫持久化</h1><p>在项目根目录下通过如下命令启动爬虫，其中dmoz为spider类中指定的name值。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl dmoz -s <span class="attribute">JOBDIR</span>=crawls/dmoz-1</span><br></pre></td></tr></table></figure></p>
<p>按ctrl-c就可以暂停。再次运行以上命令就可以继续运行。</p>
<h1 id="inferences"><a href="#inferences" class="headerlink" title="inferences"></a>inferences</h1><p><a href="http://www.cnblogs.com/sirkevin/p/5805795.html" target="_blank" rel="noopener">网络爬虫：使用Scrapy框架编写一个抓取书籍信息的爬虫服务</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/develepment/transformer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/develepment/transformer/" class="post-title-link" itemprop="url">transformer</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/develepment/" itemprop="url" rel="index"><span itemprop="name">develepment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>transformer模块为特征工程模块，encoder为其基本单元，encoder的作用为进行特征变换。</p>
<p>此文档用于规范encoder类的编写，同时列出各个encoder的参数列表。</p>
<h1 id="编写规范"><a href="#编写规范" class="headerlink" title="编写规范"></a>编写规范</h1><ol>
<li><p>类取名应该清晰易懂， 符合一般规范（各单词首字母大写），以Encoder结尾， 例如<code>BaseEncoder</code>, <code>WOEEncoder</code>。对于只适用于cont的Encoder类应该以Cont作为类名开头，对于只适用于cate的Encoder类应该以Cate作为类名开头。</p>
</li>
<li><p>类必须包含<code>__init__</code>、<code>fit</code>和<code>transformer</code>方法，transformer模块也只会调用这三个方法</p>
</li>
<li><p>fit方法必须形如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 形式1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fit</span><span class="params">(self, df, y=None)</span>:</span></span><br><span class="line">    ···</span><br><span class="line"></span><br><span class="line"><span class="comment"># 形式2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fit</span><span class="params">(self, df, y)</span>:</span></span><br><span class="line">    ···</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不需要return</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>transformer方法必须形如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transform</span><span class="params">(self, df)</span>:</span></span><br><span class="line">    <span class="comment"># 一系列处理过程</span></span><br><span class="line">    df_final = df.copy()</span><br><span class="line">    ...</span><br><span class="line">    df_final.columns = df.columns</span><br><span class="line">    <span class="keyword">return</span> df.final</span><br><span class="line"></span><br><span class="line"><span class="comment"># return必须是pandas.DataFrame,不能乱序，顺序必须和传入的df一致(最好保持index和传入的df一致，目前会在外部再做一次index对齐处理防止index不一致,最后列名也需要复原出来，因为某些方法会删掉列名)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>异常处理和错误抛出规范：不要使用<code>try...except...</code>进行异常跳出，目前只需要正常让程序自行报错即可</p>
</li>
<li><p>必须有类注释，形如：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">"""</span><br><span class="line">用于剔除缺失值严重列，同值严重列，不同值严重cate列（字符串列如果取值太过于分散，则信息量过低）。</span><br><span class="line"></span><br><span class="line">适用于cont和cate，支持缺失值, 建议放置在encoder序列第一位次</span><br><span class="line"></span><br><span class="line">Parameters</span><br><span class="line">----------</span><br><span class="line">missing<span class="emphasis">_thr: 0.8, 缺失率高于该值的列会被剔除</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">same_</span>thr: 0.8, 同值率高于该值的列会被剔除</span><br><span class="line"></span><br><span class="line">caate<span class="emphasis">_thr: 0.9， 取值分散率高于该值的字符串列会被剔除</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">Attributes</span></span><br><span class="line"><span class="emphasis">----------</span></span><br><span class="line"><span class="emphasis">missing_</span>cols: list, 被剔除的缺失值列</span><br><span class="line"></span><br><span class="line">same<span class="emphasis">_cols: list, 被剔除的同值列</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">cate_</span>cols: list, 被剔除的取值分散字符串列</span><br><span class="line"></span><br><span class="line">exclude<span class="emphasis">_cols: list, 被剔除的列名</span></span><br><span class="line"><span class="emphasis">"""</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>完成后必须进行单元测试，自测通过</p>
</li>
</ol>
<h1 id="BaseEncoder"><a href="#BaseEncoder" class="headerlink" title="BaseEncoder"></a>BaseEncoder</h1><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">"""</span><br><span class="line">用于剔除缺失值严重列，同值严重列，不同值严重cate列（字符串列如果取值太过于分散，则信息量过低）。</span><br><span class="line"></span><br><span class="line">适用于cont和cate，支持缺失值, 建议放置在encoder序列第一位次</span><br><span class="line"></span><br><span class="line">Parameters</span><br><span class="line">----------</span><br><span class="line">missing<span class="emphasis">_thr: 0.8, 缺失率高于该值的列会被剔除</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">same_</span>thr: 0.8, 同值率高于该值的列会被剔除</span><br><span class="line"></span><br><span class="line">caate<span class="emphasis">_thr: 0.9， 取值分散率高于该值的字符串列会被剔除</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">Attributes</span></span><br><span class="line"><span class="emphasis">----------</span></span><br><span class="line"><span class="emphasis">missing_</span>cols: list, 被剔除的缺失值列</span><br><span class="line"></span><br><span class="line">same<span class="emphasis">_cols: list, 被剔除的同值列</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">cate_</span>cols: list, 被剔除的取值分散字符串列</span><br><span class="line"></span><br><span class="line">exclude<span class="emphasis">_cols: list, 被剔除的列名</span></span><br><span class="line"><span class="emphasis">"""</span></span><br></pre></td></tr></table></figure>
<h1 id="NothingEncoder"><a href="#NothingEncoder" class="headerlink" title="NothingEncoder"></a>NothingEncoder</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">原样返回，不做任何处理。本用于测试，现在transformer支持在encoders序列为空情况下原样返回，此类已无实际用途。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">适用于cont和cate，支持缺失值</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<h1 id="DropEncoder"><a href="#DropEncoder" class="headerlink" title="DropEncoder"></a>DropEncoder</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">此类用于返回空df，换言之删除所有字段。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">适用于cont和cate， 支持缺失值</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<h1 id="ContImupterEncoder"><a href="#ContImupterEncoder" class="headerlink" title="ContImupterEncoder"></a>ContImupterEncoder</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">"""</span><br><span class="line">此类继承自sklearn.preprocessing.Imputer，fit与基类完全一致，transform方法返回变为pandas.DataFrame。</span><br><span class="line"></span><br><span class="line">仅适用于cont， 支持缺失值</span><br><span class="line"></span><br><span class="line">Parameters</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">missing_values : integer or "NaN", optional (default="NaN")</span><br><span class="line">    The placeholder for the missing values. <span class="keyword">All</span> occurrences <span class="keyword">of</span></span><br><span class="line">    <span class="string">`missing_values`</span> will be imputed. <span class="keyword">For</span> <span class="keyword">missing</span> <span class="keyword">values</span> encoded <span class="keyword">as</span> np.nan,</span><br><span class="line">    <span class="keyword">use</span> the <span class="keyword">string</span> <span class="keyword">value</span> <span class="string">"NaN"</span>.</span><br><span class="line"></span><br><span class="line">strategy : <span class="keyword">string</span>, optional (<span class="keyword">default</span>=<span class="string">"mean"</span>)</span><br><span class="line">    The imputation strategy.</span><br><span class="line"></span><br><span class="line">    - <span class="keyword">If</span> <span class="string">"mean"</span>, <span class="keyword">then</span> <span class="keyword">replace</span> <span class="keyword">missing</span> <span class="keyword">values</span> <span class="keyword">using</span> the mean along</span><br><span class="line">      the axis.</span><br><span class="line">    - <span class="keyword">If</span> <span class="string">"median"</span>, <span class="keyword">then</span> <span class="keyword">replace</span> <span class="keyword">missing</span> <span class="keyword">values</span> <span class="keyword">using</span> the <span class="keyword">median</span> along</span><br><span class="line">      the axis.</span><br><span class="line">    - <span class="keyword">If</span> <span class="string">"most_frequent"</span>, <span class="keyword">then</span> <span class="keyword">replace</span> <span class="keyword">missing</span> <span class="keyword">using</span> the most frequent</span><br><span class="line">      <span class="keyword">value</span> along the axis.</span><br><span class="line"></span><br><span class="line">axis : <span class="built_in">integer</span>, optional (<span class="keyword">default</span>=<span class="number">0</span>)</span><br><span class="line">    The axis along which <span class="keyword">to</span> impute.</span><br><span class="line"></span><br><span class="line">    - <span class="keyword">If</span> <span class="string">`axis=0`</span>, <span class="keyword">then</span> impute along columns.</span><br><span class="line">    - <span class="keyword">If</span> <span class="string">`axis=1`</span>, <span class="keyword">then</span> impute along rows.</span><br><span class="line"></span><br><span class="line">verbose : <span class="built_in">integer</span>, optional (<span class="keyword">default</span>=<span class="number">0</span>)</span><br><span class="line">    Controls the verbosity <span class="keyword">of</span> the imputer.</span><br><span class="line"></span><br><span class="line">copy : <span class="built_in">boolean</span>, optional (<span class="keyword">default</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">If</span> <span class="literal">True</span>, a copy <span class="keyword">of</span> X will be created. <span class="keyword">If</span> <span class="literal">False</span>, imputation will</span><br><span class="line">    be done <span class="keyword">in</span>-place <span class="keyword">whenever</span> possible. Note that, <span class="keyword">in</span> the <span class="keyword">following</span> cases,</span><br><span class="line">    a <span class="keyword">new</span> copy will <span class="keyword">always</span> be made, even <span class="keyword">if</span> <span class="string">`copy=False`</span>:</span><br><span class="line"></span><br><span class="line">    - <span class="keyword">If</span> X <span class="keyword">is</span> <span class="keyword">not</span> an <span class="built_in">array</span> <span class="keyword">of</span> floating <span class="keyword">values</span>;</span><br><span class="line">    - If X is sparse and `missing_values=0`;</span><br><span class="line">    - If `axis=0` and X is encoded as a CSR matrix;</span><br><span class="line">    - If `axis=1` and X is encoded as a CSC matrix.</span><br><span class="line"></span><br><span class="line">Attributes</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">enc : 实例化的Imputer对象</span><br><span class="line"></span><br><span class="line">enc.statistics_ : array of shape (n_features,)</span><br><span class="line">    The imputation fill value for each feature if axis == 0.</span><br><span class="line"></span><br><span class="line">Notes</span><br><span class="line"><span class="comment">-----</span></span><br><span class="line">- When ``axis=0``, columns which only contained missing <span class="keyword">values</span> <span class="keyword">at</span> <span class="string">`fit`</span></span><br><span class="line">  <span class="keyword">are</span> discarded upon <span class="string">`transform`</span>.</span><br><span class="line">- <span class="keyword">When</span> <span class="string">``</span>axis=<span class="number">1</span><span class="string">``</span>, an <span class="keyword">exception</span> <span class="keyword">is</span> raised <span class="keyword">if</span> there <span class="keyword">are</span> <span class="keyword">rows</span> <span class="keyword">for</span> which it <span class="keyword">is</span></span><br><span class="line">  <span class="keyword">not</span> possible <span class="keyword">to</span> fill <span class="keyword">in</span> the <span class="keyword">missing</span> <span class="keyword">values</span> (e.g., because they <span class="keyword">only</span></span><br><span class="line">  contain <span class="keyword">missing</span> <span class="keyword">values</span>).    </span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<h1 id="ContBinningEncoder"><a href="#ContBinningEncoder" class="headerlink" title="ContBinningEncoder"></a>ContBinningEncoder</h1><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">"""</span><br><span class="line">将连续型变量转化为离散型</span><br><span class="line"></span><br><span class="line">仅适用于cont， 支持缺失值</span><br><span class="line"></span><br><span class="line">Parameters</span><br><span class="line">----------</span><br><span class="line">diff<span class="emphasis">_thr: 20, 不同取值数高于该值才进行离散化处理，不然原样返回</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">binning_</span>method: <span class="emphasis">'dt'</span>，分箱方法, 可用取值为<span class="emphasis">'dt'</span>， <span class="emphasis">'qcut'</span>， <span class="emphasis">'cut'</span></span><br><span class="line"></span><br><span class="line">bins: 10, 分箱数目， 当binning<span class="emphasis">_method='dt'时，该参数失效</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">**kwargs: 决策树分箱方法使用的决策树参数</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">"""</span></span><br></pre></td></tr></table></figure>
<h1 id="WOEEncoder"><a href="#WOEEncoder" class="headerlink" title="WOEEncoder"></a>WOEEncoder</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">woe变换</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">适用于cont和cate，但对多取值cont无效，支持缺失值</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Parameters</span></span><br><span class="line"><span class="string">----------</span></span><br><span class="line"><span class="string">diff_thr: 20， 不同取值数小于等于该值的才进行woe变换，不然原样返回</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">woe_min: -20， woe的截断最小值</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">woe_max: 20， woe的截断最大值</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">nan_thr: 0.01， 对缺失值采用平滑方法计算woe值，nan_thr为平滑参数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/develepment/多线程&多进程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/develepment/多线程&多进程/" class="post-title-link" itemprop="url">多线程&多进程</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/develepment/" itemprop="url" rel="index"><span itemprop="name">develepment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><p>对于单核cpu，同一时间只可能运行一个线程。只是由于线程任务可能存在一些必要的挂起时间（等待I/O等），这个时间被迅速切换来运行下一个线程，从而带来了挂起时间的节约和相应加速。</p>
<p>多核cpu情况下，多线程则存在核间资源共享的问题。python的GIL机制则是一个相当糟糕的解决方案。使得多线程效率可能还不如单线程。</p>
<h1 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h1><p>每个核分别处理任务，可以不受其他任务影响的并行。特定需求下，也存在进程间通信的问题。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/git/git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/git/git/" class="post-title-link" itemprop="url">git</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Git-fatal-Pathspec-is-in-submodule"><a href="#Git-fatal-Pathspec-is-in-submodule" class="headerlink" title="Git: fatal: Pathspec is in submodule"></a>Git: fatal: Pathspec is in submodule</h1><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git rm <span class="comment">--cached directory</span></span><br><span class="line">git <span class="built_in">add</span> <span class="built_in">directory</span></span><br></pre></td></tr></table></figure>
<p><a href="https://stackoverflow.com/questions/24472596/git-fatal-pathspec-is-in-submodule" target="_blank" rel="noopener">Git: fatal: Pathspec is in submodule</a></p>
<h1 id="PR"><a href="#PR" class="headerlink" title="PR"></a>PR</h1><p>使用别人的repo代码，发现问题想要更正以后合并，可以通过以下方法：</p>
<ol>
<li>fork repo</li>
<li>git clone自己fork过来的repo到本地</li>
<li>本地正常修改提交</li>
<li>在自己fork的repo上发pr申请，等待原仓库管理员merge</li>
</ol>
<h1 id="本地仓库和线上仓库关联"><a href="#本地仓库和线上仓库关联" class="headerlink" title="本地仓库和线上仓库关联"></a>本地仓库和线上仓库关联</h1><p>想要把本地仓库和一个线上的仓库合并：</p>
<ol>
<li><p>本地仓库和线上仓库同名</p>
</li>
<li><p>如果本地仓库只是文件夹，需要<code>git init</code></p>
</li>
<li><p>创建关联，<code>git remote add origin &lt;线上repo ssh地址&gt;</code></p>
</li>
<li><p>先把线上仓库拉取合并下来，<code>git pull origin master</code></p>
</li>
<li><p>本地仓库推到线上，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m ""</span><br><span class="line">git push -u origin master #-u是对线上和线下master进行关联，以后就不需要加了</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="创建本地分支并推上线"><a href="#创建本地分支并推上线" class="headerlink" title="创建本地分支并推上线"></a>创建本地分支并推上线</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b test</span><br><span class="line">git add -A</span><br><span class="line">git commit -m "test"</span><br><span class="line">git push -u origin test:test</span><br></pre></td></tr></table></figure>
<h1 id="本地repo同时推到两个线上repo"><a href="#本地repo同时推到两个线上repo" class="headerlink" title="本地repo同时推到两个线上repo"></a>本地repo同时推到两个线上repo</h1><p>reference: <a href="https://gist.github.com/rvl/c3f156e117e22a25f242" target="_blank" rel="noopener">Pushing to Multiple Git Repos</a></p>
<p>流程如下：</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># remote</span></span><br><span class="line"><span class="string">git </span><span class="string">remote </span><span class="string">add </span><span class="string">github </span><span class="string">git@</span><span class="string">github.</span><span class="string">com:muccg/</span><span class="string">my-project.</span><span class="string">git</span></span><br><span class="line"><span class="string">git </span><span class="string">remote </span><span class="string">add </span><span class="string">bb </span><span class="string">git@</span><span class="string">bitbucket.</span><span class="string">org:ccgmurdoch/</span><span class="string">my-project.</span><span class="string">git</span></span><br><span class="line"><span class="string">#</span> <span class="string">Remote </span><span class="string">Push </span><span class="string">URLs</span></span><br><span class="line"><span class="string">git </span><span class="string">remote </span><span class="built_in">set-url</span> <span class="built_in">--add</span> <span class="built_in">--push</span> <span class="string">origin </span><span class="string">git@</span><span class="string">github.</span><span class="string">com:muccg/</span><span class="string">my-project.</span><span class="string">git</span></span><br><span class="line"><span class="string">git </span><span class="string">remote </span><span class="built_in">set-url</span> <span class="built_in">--add</span> <span class="built_in">--push</span> <span class="string">origin </span><span class="string">git@</span><span class="string">bitbucket.</span><span class="string">org:ccgmurdoch/</span><span class="string">my-project.</span><span class="string">git</span></span><br><span class="line"><span class="string">#</span> <span class="string">pull </span><span class="string">multiple</span></span><br><span class="line"><span class="string">git </span><span class="string">fetch </span><span class="built_in">--all</span></span><br><span class="line"><span class="built_in">git</span> <span class="string">merge </span><span class="string">github/</span><span class="string">next_release </span><span class="string">bb/</span><span class="string">next_release</span></span><br></pre></td></tr></table></figure>
<p>在pull multiple步骤，可能会报如下错误<code>fatal: refusing to merge unrelated histories</code>,只需要在pull或者merge时加上<code>--allow-unrelated-histories</code>参数，在手动合并代码冲突即可。</p>
<p>下面提供一个更简单的方案，没有经过严格测试：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改.git/config文件，加入如下一段话</span></span><br><span class="line">[remote <span class="string">"all"</span>]</span><br><span class="line">url = https:<span class="regexp">//gi</span>thub.com<span class="regexp">/segment/</span>test.git</span><br><span class="line">url = https:<span class="regexp">//gi</span>t.oschina.net<span class="regexp">/segment/</span>test.git</span><br><span class="line"><span class="comment"># pull合并代码</span></span><br><span class="line">git pull all master --allow-unrelated-histories</span><br></pre></td></tr></table></figure>
<p>注意，这个方案另开了一个all分支，可能更安全，也可以直接修改origin。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/environment/IDEA操作技巧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/environment/IDEA操作技巧/" class="post-title-link" itemprop="url">IDEA操作技巧</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/environment/" itemprop="url" rel="index"><span itemprop="name">environment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本机环境： ubuntu16.04</p>
<h1 id="IDEA-卡顿"><a href="#IDEA-卡顿" class="headerlink" title="IDEA 卡顿"></a>IDEA 卡顿</h1><p>参考<a href="http://blog.csdn.net/u013068377/article/details/54316965" target="_blank" rel="noopener">解决IDEA卡顿问题及相关基本配置</a></p>
<p>进入IDEA安装目录，进一步进入bin目录，修改<code>idea64.vmoptions</code>文件（windows下文件名略有区别）</p>
<p>将文件中<code>-Xmx?m</code> 改为你需要分配的内存数量，比如改为<code>-Xmx2048m</code>。</p>
<h1 id="IDEA-中文环境"><a href="#IDEA-中文环境" class="headerlink" title="IDEA  中文环境"></a>IDEA  中文环境</h1><p>依旧是修改<code>idea64.vmoptions</code>,在最后增加一行</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dfile.<span class="attribute">encoding</span>=utf8</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/environment/centos7.4安装机器学习环境/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/environment/centos7.4安装机器学习环境/" class="post-title-link" itemprop="url">centos7.4安装机器学习环境</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/environment/" itemprop="url" rel="index"><span itemprop="name">environment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>centos+python3的dockerfile， 并且配置中文环境支持</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yum install wget -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /tmp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wget https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tar -xzvf Python-3.6.1.tgz -C /tmp</span></span><br><span class="line">yum -y update</span><br><span class="line">yum install yum-plugin-ovl gcc zlib* openssl* mysql mysql-devel mysql-lib gcc-c++ bzip2-devel sqlite-devel bzip2 mesa-libGL-devel -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /tmp/Python-3.6.1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./configure --prefix=/usr/<span class="built_in">local</span> &amp;&amp; make &amp;&amp; make install</span></span><br><span class="line">cd /tmp</span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-5.1.0-Linux-x86_64.sh</span><br><span class="line">bash Anaconda3-5.1.0-Linux-x86_64.sh -b -p /home/anaconda3</span><br><span class="line">echo 'export PATH="/home/anaconda3/bin:$PATH"' &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br><span class="line">/home/anaconda3/bin/pip install -i https://mirrors.aliyun.com/pypi/simple cmake PyQt5 dill bayesian-optimization category_encoders seaborn graphviz xgboost</span><br></pre></td></tr></table></figure>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> daocloud.io/library/centos:<span class="number">7.2</span>.<span class="number">1511</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install wget -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> wget https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> tar -xzvf Python-3.6.1.tgz</span></span><br><span class="line"><span class="comment"># RUN yum -y update</span></span><br><span class="line"><span class="comment"># 用来解决Rpmdb checksum is invalid: dCDPT(pkg checksums) 问题</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install yum-plugin-ovl</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install gcc -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install zlib* -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install openssl* -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install mysql mysql-devel mysql-lib -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install gcc-c++ -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install bzip2-devel -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install sqlite-devel -y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ./Python-3.6.1/configure --prefix=/usr/<span class="built_in">local</span> \</span></span><br><span class="line"><span class="bash">&amp;&amp; make\</span></span><br><span class="line"><span class="bash">&amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RUN mkdir -p /workspace/python_file</span></span><br><span class="line"><span class="comment"># COPY test /workspace/python_file</span></span><br><span class="line"><span class="comment">#WORKDIR /home;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir analyze-server</span></span><br><span class="line"><span class="comment"># add and install requirements.txt</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /analyze-server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> . /analyze-server</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ls</span></span><br><span class="line"><span class="comment">#RUN pip3 install --no-index --find-links=/ae-server/packages -r /ae-server/ae-server-requirements.txt</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip3 install -i https://mirrors.aliyun.com/pypi/simple -r /analyze-server/analyze-server-requirements.txt</span></span><br><span class="line"><span class="comment"># RUN pip3 install -i https://mirrors.aliyun.com/pypi/simple gensim</span></span><br><span class="line"><span class="comment">#RUN export LD_LIBLABRARY_PATH = /usr/local/cuda-8.0/lib64:$LD_LIBLABRARY_PATH</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">5000</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8888</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">6006</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> localedef -i en_US -f UTF-8 en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG=en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="comment">#ENTRYPOINT ["python3"]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"python3"</span>, <span class="string">"manage.py"</span>, <span class="string">"runserver"</span>, <span class="string">"-h"</span>, <span class="string">"0.0.0.0"</span>, <span class="string">"-p"</span>, <span class="string">"5000"</span>]</span></span><br></pre></td></tr></table></figure>
<p>其中，如果出现Rpmdb checksum is invalid: dCDPT(pkg checksums)报错，可以这样解决</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN yum -y <span class="keyword">update</span> \</span><br><span class="line">    &amp;&amp; yum -y <span class="keyword">install</span> yum-<span class="keyword">plugin</span>-ovl</span><br></pre></td></tr></table></figure>
<p>参考<a href="https://unix.stackexchange.com/questions/348941/rpmdb-checksum-is-invalid-trying-to-install-gcc-in-a-centos-7-2-docker-image" target="_blank" rel="noopener">Rpmdb checksum is invalid - Trying to install gcc in a CentOS 7.2 docker image</a></p>
<p>centos中文环境支持，<a href="https://github.com/CentOS/sig-cloud-instance-images/issues/71" target="_blank" rel="noopener">Default locale is set to en_US.UTF-8 but it’s missing</a></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">RUN</span> localedef -i en_US -f UTF-8 en_US.UTF-8</span><br><span class="line">ENV <span class="attribute">LANG</span>=en_US.UTF-8</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/environment/docker for tensorflow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/environment/docker for tensorflow/" class="post-title-link" itemprop="url">docker for tensorflow</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/environment/" itemprop="url" rel="index"><span itemprop="name">environment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="nvidia-docker"><a href="#nvidia-docker" class="headerlink" title="nvidia-docker"></a>nvidia-docker</h1><p>需要安装nvidia-docker用于docker和宿主机之间的gpu资源共享</p>
<p><a href="https://github.com/NVIDIA/nvidia-docker" target="_blank" rel="noopener">Docker Engine Utility for NVIDIA GPUs</a> 给出了详细的安装过程。</p>
<p>对于ubuntu，使用如下命令</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -P <span class="regexp">/tmp https:/</span><span class="regexp">/github.com/</span>NVIDIA<span class="regexp">/nvidia-docker/</span>releases<span class="regexp">/download/</span>v1<span class="number">.0</span><span class="number">.1</span>/nvidia-docker_1<span class="number">.0</span><span class="number">.1</span><span class="number">-1</span>_amd64.deb</span><br><span class="line">sudo dpkg -i <span class="regexp">/tmp/</span>nvidia-docker*.deb &amp;&amp; rm <span class="regexp">/tmp/</span>nvidia-docker*.deb</span><br></pre></td></tr></table></figure>
<p>测试是否安装成功：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-docker <span class="built_in">run</span> <span class="comment">--rm nvidia/cuda nvidia-smi</span></span><br></pre></td></tr></table></figure>
<p>在运行和gpu相关的docker镜像时，把 <code>docker run</code>改成 <code>nvidia-docker run</code>即可。如果报错，可能是plugin没有启动，先后台运行<code>nvidia-docker-plugin</code>。</p>
<h1 id="tenorflow-gpu-docker"><a href="#tenorflow-gpu-docker" class="headerlink" title="tenorflow-gpu docker"></a>tenorflow-gpu docker</h1><p>我选择的镜像是<code>tensorflow/tensorflow:1.2.1-devel-gpu-py3</code></p>
<p>具体的可选择镜像可以看<a href="https://github.com/denverdino/tensorflow-docker" target="_blank" rel="noopener">Tensorflow Docker image with Aliyun mirror</a>。其实不需要专门使用阿里云，我没有找到官方镜像名列表，所以拿这个做个镜像名索引而已。。</p>
<p>如果在run镜像时出现类似这样的报错 <code>An error occurred trying to connect: Get http:///var/run/docker.sock/v1.21/create..container。。EOF</code>，可以采用以下解决方法：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service docker stop</span><br><span class="line">sudo rm /var/<span class="class"><span class="keyword">lib</span>/<span class="title">docker</span>/<span class="title">network</span>/<span class="title">files</span>/<span class="title">local</span>-<span class="title">kv</span>.<span class="title">db</span></span></span><br><span class="line">service docker start</span><br></pre></td></tr></table></figure>
<p>也需要重启<code>nvidia-docker-plugin</code>，即可解决。 解决方案参考<a href="https://github.com/moby/moby/issues/17846" target="_blank" rel="noopener">An error occurred trying to connect version 1.9.0</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/environment/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/environment/docker/" class="post-title-link" itemprop="url">docker</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/environment/" itemprop="url" rel="index"><span itemprop="name">environment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ubuntu-安装-docker-服务"><a href="#ubuntu-安装-docker-服务" class="headerlink" title="ubuntu 安装 docker 服务"></a>ubuntu 安装 docker 服务</h1><p>docker ce为社区版，docker ee为企业版</p>
<p><a href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/#install-using-the-repository" target="_blank" rel="noopener">Get Docker CE for Ubuntu</a></p>
<h1 id="拉取docker镜像"><a href="#拉取docker镜像" class="headerlink" title="拉取docker镜像"></a>拉取docker镜像</h1><p>国内由于网络原因往往无法直接从docker hub上面拉下来镜像，这时可以在<a href="http://www.daocloud.io/" target="_blank" rel="noopener">daocloud</a>上面寻找相同镜像拉下来。</p>
<h1 id="制作-docker-镜像和容器"><a href="#制作-docker-镜像和容器" class="headerlink" title="制作 docker 镜像和容器"></a>制作 docker 镜像和容器</h1><p>写好dockerfile之后，<code>docker build -t dockername .</code>即可。</p>
<p>具体的dockerfile样例下文提供。</p>
<p>制作好镜像之后<code>docker run --name ae -p 5555:5555 -d ae:latest</code></p>
<p><code>-d</code> 后台运行</p>
<p><code>-p</code> 端口映射</p>
<p><code>--name</code> 制定文件名</p>
<p><code>--env</code> 可以设定环境变量。该参数可以用来将一些宿主机信息比如ip写入docker容器，从而方便docker容器内部从环境变量中拿到宿主机信息。</p>
<p>如果想要查看容器的log，可以<code>docker logs ae</code></p>
<h1 id="docker常用操作"><a href="#docker常用操作" class="headerlink" title="docker常用操作"></a>docker常用操作</h1><p>删除Docker容器， <code>docker rm dockername</code></p>
<p>停止docker容器， <code>docker stop dockername</code></p>
<p>如果想要删除docker镜像，必须先删除有该镜像生成的所有容器，然后 <code>docker rmi dockerimagename</code></p>
<p>查看运行中的docker 容器， <code>docker ps</code></p>
<p>查看包括非运行状态的所有docker容器， <code>docker ps -a</code></p>
<p>停止所有的container， <code>docker stop $(docker ps -a -q)</code></p>
<p>删除所有container， <code>docker rm $(docker ps -a -q)</code></p>
<p>查看images， <code>docker images</code></p>
<p>想要删除untagged images，也就是那些id为<none>的image的话可以用, <code>docker rmi $(docker images | grep &quot;^&lt;none&gt;&quot; | awk &quot;{print $3}&quot;)</code></none></p>
<p>要删除全部image的话, <code>docker rmi $(docker images -q)</code></p>
<h1 id="docker-和宿主机交互操作"><a href="#docker-和宿主机交互操作" class="headerlink" title="docker 和宿主机交互操作"></a>docker 和宿主机交互操作</h1><p>把宿主机文件（夹）复制到docker， <code>docker cp src container_id:dst</code></p>
<p>把docker文件复制到宿主机， <code>docker cp container_id:src dst</code></p>
<p>在容器内获得宿主机公网ip， <code>curl ifconfig.me</code></p>
<p>在容器内获得宿主机私网ip，先将ip写入容器环境变量 <code>docker run --env hostip=‘ip’ docker-id</code>， 然后在容器内部通过读取环境变量来得到hostip信息。如果是python,可以<code>os.environ[&#39;环境变量名称&#39;]</code>来获取环境变量。</p>
<h1 id="inference"><a href="#inference" class="headerlink" title="inference"></a>inference</h1><p><a href="http://www.cnblogs.com/q4486233/p/6482711.html" target="_blank" rel="noopener">Docker 容器镜像删除</a></p>
<p><a href="http://dockone.io/question/441" target="_blank" rel="noopener">如何从容器内部获取主机IP</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/environment/docker_centos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/environment/docker_centos/" class="post-title-link" itemprop="url">docker_centos</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/environment/" itemprop="url" rel="index"><span itemprop="name">environment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>centos+python3的dockerfile， 并且配置中文环境支持</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> daocloud.io/library/centos:<span class="number">7.2</span>.<span class="number">1511</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install wget -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> wget https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> tar -xzvf Python-3.6.1.tgz</span></span><br><span class="line"><span class="comment"># RUN yum -y update</span></span><br><span class="line"><span class="comment"># 用来解决Rpmdb checksum is invalid: dCDPT(pkg checksums) 问题</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install yum-plugin-ovl</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install gcc -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install zlib* -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install openssl* -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install mysql mysql-devel mysql-lib -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install gcc-c++ -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install bzip2-devel -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install sqlite-devel -y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ./Python-3.6.1/configure --prefix=/usr/<span class="built_in">local</span> \</span></span><br><span class="line"><span class="bash">&amp;&amp; make\</span></span><br><span class="line"><span class="bash">&amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RUN mkdir -p /workspace/python_file</span></span><br><span class="line"><span class="comment"># COPY test /workspace/python_file</span></span><br><span class="line"><span class="comment">#WORKDIR /home;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir analyze-server</span></span><br><span class="line"><span class="comment"># add and install requirements.txt</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /analyze-server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> . /analyze-server</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ls</span></span><br><span class="line"><span class="comment">#RUN pip3 install --no-index --find-links=/ae-server/packages -r /ae-server/ae-server-requirements.txt</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip3 install -i https://mirrors.aliyun.com/pypi/simple -r /analyze-server/analyze-server-requirements.txt</span></span><br><span class="line"><span class="comment"># RUN pip3 install -i https://mirrors.aliyun.com/pypi/simple gensim</span></span><br><span class="line"><span class="comment">#RUN export LD_LIBLABRARY_PATH = /usr/local/cuda-8.0/lib64:$LD_LIBLABRARY_PATH</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">5000</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8888</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">6006</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> localedef -i en_US -f UTF-8 en_US.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG=en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="comment">#ENTRYPOINT ["python3"]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"python3"</span>, <span class="string">"manage.py"</span>, <span class="string">"runserver"</span>, <span class="string">"-h"</span>, <span class="string">"0.0.0.0"</span>, <span class="string">"-p"</span>, <span class="string">"5000"</span>]</span></span><br></pre></td></tr></table></figure>
<p>其中，如果出现Rpmdb checksum is invalid: dCDPT(pkg checksums)报错，可以这样解决</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN yum -y <span class="keyword">update</span> \</span><br><span class="line">    &amp;&amp; yum -y <span class="keyword">install</span> yum-<span class="keyword">plugin</span>-ovl</span><br></pre></td></tr></table></figure>
<p>参考<a href="https://unix.stackexchange.com/questions/348941/rpmdb-checksum-is-invalid-trying-to-install-gcc-in-a-centos-7-2-docker-image" target="_blank" rel="noopener">Rpmdb checksum is invalid - Trying to install gcc in a CentOS 7.2 docker image</a></p>
<p>centos中文环境支持，<a href="https://github.com/CentOS/sig-cloud-instance-images/issues/71" target="_blank" rel="noopener">Default locale is set to en_US.UTF-8 but it’s missing</a></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">RUN</span> localedef -i en_US -f UTF-8 en_US.UTF-8</span><br><span class="line">ENV <span class="attribute">LANG</span>=en_US.UTF-8</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/environment/fastdfs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/environment/fastdfs/" class="post-title-link" itemprop="url">fastdfs</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/environment/" itemprop="url" rel="index"><span itemprop="name">environment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="fastdfs"><a href="#fastdfs" class="headerlink" title="fastdfs"></a>fastdfs</h1><p>因工作需要搭建一个分布式文件系统，用于文件存储。公司的选择是fastdfs。<br>fastdfs上传文件时系统自动指定路径和文件名，因此如果想要传一个文件夹上去。内部的目录结构会被打乱。不会再以完整文件夹形式存储在服务器上。</p>
<p>fastdfs作者有对fastdfs优缺点和问题做过总结，见 <a href="http://bbs.chinaunix.net/thread-1920470-1-1.html" target="_blank" rel="noopener">FastDFS FAQ</a></p>
<h1 id="fastdfs-部署"><a href="#fastdfs-部署" class="headerlink" title="fastdfs 部署"></a>fastdfs 部署</h1><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span> &amp;&amp; <span class="built_in">mkdir</span> fastdfs &amp;&amp; <span class="keyword">cd</span> fastdfs  </span><br><span class="line">git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/happyfish100/fastdfs.git  </span><br><span class="line">git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/happyfish100/libfastcommon.git  </span><br><span class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/fastdfs/libfastcommon  </span><br><span class="line">./<span class="keyword">make</span>.<span class="keyword">sh</span> &amp;&amp; ./<span class="keyword">make</span>.<span class="keyword">sh</span> install  </span><br><span class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/fastdfs/fastdfs  </span><br><span class="line">./<span class="keyword">make</span>.<span class="keyword">sh</span> &amp;&amp; ./<span class="keyword">make</span>.<span class="keyword">sh</span> install</span><br></pre></td></tr></table></figure>
<p>安装成功后，FastDFS安装在/usr/bin中。配置文件在/etc/fdfs中。</p>
<p>配置文件放在/etc/fdfs下面：</p>
<p>client配置文件：/etc/fdfs/client.conf.sample</p>
<p>storage配置文件：/etc/fdfs/storage.com.sample</p>
<p>tracker配置文件：/etc/fdfs/tracker.com.sample</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/fdfs  </span><br><span class="line">mv client<span class="selector-class">.conf</span><span class="selector-class">.sample</span> client<span class="selector-class">.conf</span>  </span><br><span class="line">mv storage<span class="selector-class">.conf</span><span class="selector-class">.sample</span> storage<span class="selector-class">.conf</span>  </span><br><span class="line">mv tracker<span class="selector-class">.conf</span><span class="selector-class">.sample</span> tracker.conf</span><br></pre></td></tr></table></figure>
<p>如果只是使用python客户端进行文件上传下载操作。应该只需要修改 client.conf 即可。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">base_path</span>=/etc/fdfs</span><br><span class="line"><span class="attr">tracker_server</span>=node2:<span class="number">22122</span>  </span><br><span class="line"><span class="attr">tracker_server</span>=node3:<span class="number">22122</span></span><br></pre></td></tr></table></figure>
<p>其中tracker_server是master ip。可以只有一个。</p>
<p>具体安装细节参见 <a href="http://blog.csdn.net/lavorange/article/details/50814086" target="_blank" rel="noopener">【FastDFS分布式文件系统之一】：搭建、部署、配置</a></p>
<h1 id="fdfs-client-安装和使用"><a href="#fdfs-client-安装和使用" class="headerlink" title="fdfs_client 安装和使用"></a>fdfs_client 安装和使用</h1><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/jefforeilly/fdfs_client-<span class="keyword">py</span>.git</span><br><span class="line"><span class="keyword">cd</span> fdfs_client-<span class="keyword">py</span></span><br><span class="line"><span class="keyword">vi</span> ./fdfs_client/storage_client.<span class="keyword">py</span></span><br><span class="line">将第<span class="number">12</span>行 from fdfs_client.sendfile import * 注释掉</span><br><span class="line"><span class="keyword">python3</span> setup.<span class="keyword">py</span> install</span><br><span class="line"></span><br><span class="line">sudo pip3 install mutagen</span><br></pre></td></tr></table></figure>
<p>fastdfs python客户端只有python2版本，python3版本需要自己下载源码并且修改代码后安装。</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from fdfs_client.<span class="keyword">client</span> import * </span><br><span class="line"><span class="keyword">client</span> = Fdfs_client(<span class="string">'/etc/fdfs/client.conf'</span>)</span><br><span class="line"><span class="meta"># upload</span></span><br><span class="line"><span class="keyword">client</span>.upload_by_filename(filename)  </span><br><span class="line"><span class="meta"># download</span></span><br><span class="line"><span class="keyword">client</span>.download_to_file(local_filename, remote_file_id)</span><br></pre></td></tr></table></figure>
<p>其中remote_file_id应该形如<code>group1/M00/00/00/...</code></p>
<p>具体的并行上传操作参见 <a href="http://blog.csdn.net/lavorange/article/details/50829552" target="_blank" rel="noopener">【FastDFS分布式文件系统之二】：FastDFS小文件上传性能测试及Python客户端上传操作</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/environment/flask_uwsgi_nginx部署/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/environment/flask_uwsgi_nginx部署/" class="post-title-link" itemprop="url">flask_uwsgi_nginx部署</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/environment/" itemprop="url" rel="index"><span itemprop="name">environment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/environment/host-blog-with-hexo-nginx-github/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/environment/host-blog-with-hexo-nginx-github/" class="post-title-link" itemprop="url">host-blog-with-hexo-nginx-github</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/environment/" itemprop="url" rel="index"><span itemprop="name">environment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="install-dependent-environment"><a href="#install-dependent-environment" class="headerlink" title="install dependent environment"></a>install dependent environment</h1><p>install NodeJS</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc make gcc-c++ openssl-devel wget</span><br><span class="line">wget http://nodejs.org/dist/v0.<span class="number">10.26</span>/<span class="keyword">node</span><span class="title">-v0</span>.<span class="number">10.26</span>.tar.gz</span><br><span class="line">tar -zvxf <span class="keyword">node</span><span class="title">-v0</span>.<span class="number">10.26</span>.tar.gz</span><br><span class="line">cd <span class="keyword">node</span><span class="title">-v0</span>.<span class="number">10.26</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="keyword">node</span> <span class="title">-v</span></span><br></pre></td></tr></table></figure>
<h1 id="install-hexo"><a href="#install-hexo" class="headerlink" title="install hexo"></a>install hexo</h1><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo</span><br><span class="line"><span class="built_in">mkdir</span> /<span class="built_in">home</span>/www</span><br><span class="line"><span class="built_in">mkdir</span> /<span class="built_in">home</span>/www/hexo</span><br><span class="line">cd /<span class="built_in">home</span>/www/hexo</span><br><span class="line">hexo init</span><br><span class="line">hexo generate</span><br></pre></td></tr></table></figure>
<p>config hexo<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">vi</span> _<span class="selector-tag">config</span><span class="selector-class">.yml</span></span><br></pre></td></tr></table></figure></p>
<p>change as(<em>must have a space after the “:”</em>):</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hexo Configuration  </span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/configuration.html</span></span><br><span class="line"><span class="comment">## Source: https://github.com/hexojs/hexo/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Site 站点信息设置</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">the</span> <span class="string">Home</span> <span class="string">of</span> <span class="string">MuZhen</span> <span class="comment">#站名</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="comment">#副标题</span></span><br><span class="line"><span class="attr">description:</span> <span class="comment">#站描述</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">muzhen</span> <span class="comment">#作者</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">en</span></span><br><span class="line"><span class="attr">timezone:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL 链接设置</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'</span></span><br><span class="line"><span class="attr">url:</span> <span class="attr">http://www.muzhen.tk</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory 文件目录</span></span><br><span class="line"><span class="attr">source_dir:</span> <span class="string">source</span></span><br><span class="line"><span class="attr">public_dir:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">tag_dir:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">archive_dir:</span> <span class="string">archives</span></span><br><span class="line"><span class="attr">category_dir:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">code_dir:</span> <span class="string">downloads/code</span></span><br><span class="line"><span class="attr">i18n_dir:</span> <span class="string">:lang</span></span><br><span class="line"><span class="attr">skip_render:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Writing 文章</span></span><br><span class="line"><span class="attr">new_post_name:</span> <span class="string">:title.md</span> <span class="comment"># File name of new posts</span></span><br><span class="line"><span class="attr">default_layout:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">titlecase:</span> <span class="literal">false</span> <span class="comment"># Transform title into titlecase</span></span><br><span class="line"><span class="attr">external_link:</span> <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></span><br><span class="line"><span class="attr">filename_case:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">render_drafts:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">relative_link:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">future:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">highlight:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  line_number:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  auto_detect:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  tab_replace:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Category &amp; Tag</span></span><br><span class="line"><span class="attr">default_category:</span> <span class="string">uncategorized</span></span><br><span class="line"><span class="attr">category_map:</span></span><br><span class="line"><span class="attr">tag_map:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Date / Time format 日期</span></span><br><span class="line"><span class="comment">## Hexo uses Moment.js to parse and display date</span></span><br><span class="line"><span class="comment">## You can customize the date format as defined in</span></span><br><span class="line"><span class="comment">## http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line"><span class="attr">date_format:</span> <span class="string">YYYY-MM-DD</span></span><br><span class="line"><span class="attr">time_format:</span> <span class="attr">HH:mm:ss</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pagination 分页</span></span><br><span class="line"><span class="comment">## Set per_page to 0 to disable pagination</span></span><br><span class="line"><span class="attr">per_page:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">pagination_dir:</span> <span class="string">page</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extensions 扩展</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">landscape</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deployment 这里设置了Git获</span></span><br><span class="line"><span class="comment">#这里一定要注意不要写错了，否则部署到Github上会出问题</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repo:</span> <span class="string">git@github.com:mocorochio/micorochio.github.io.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br><span class="line"><span class="attr">  message:</span></span><br></pre></td></tr></table></figure>
<h1 id="install-nginx"><a href="#install-nginx" class="headerlink" title="install nginx"></a>install nginx</h1><ol>
<li><p>install nginx</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p>configure nginx</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>nginx<span class="regexp">/conf.d/</span><span class="keyword">default</span>.conf</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>change like below:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  www.muzhen.tk muzhen.tk;</span><br><span class="line">    <span class="attribute">root</span>   /home/www/hexo/public;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="attribute">include</span> /etc/nginx/default.d/<span class="regexp">*.conf</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>use your domain replace <em><a href="http://www.muzhen.tk">www.muzhen.tk</a> muzhen.tk</em></p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service nginx <span class="built_in">start</span></span><br><span class="line">chkconfig nginx <span class="keyword">on</span></span><br></pre></td></tr></table></figure>
<h1 id="deploy-git"><a href="#deploy-git" class="headerlink" title="deploy git"></a>deploy git</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum install git </span><br><span class="line">git<span class="built_in"> config </span>--global user.name <span class="string">"your_name"</span></span><br><span class="line">git<span class="built_in"> config </span>--global user.email <span class="string">"your_email"</span></span><br><span class="line">git<span class="built_in"> config </span>--list</span><br><span class="line"></span><br><span class="line"><span class="comment"># checking for existing SSH keys</span></span><br><span class="line">ls -al ~/.ssh</span><br><span class="line"><span class="comment"># if not,generate a new SSH key</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">"your_email"</span></span><br><span class="line"><span class="comment"># type Enter for following options</span></span><br></pre></td></tr></table></figure>
<p>create a new repository.It’s name must be your_name.github.io.Then add vps SSH key to <a href="https://github.com/settings/keys" target="_blank" rel="noopener">github SSH keys</a>.<br>vps SSH key can find use code below:<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less ~<span class="regexp">/.ssh/i</span>d_rsa.pub</span><br></pre></td></tr></table></figure></p>
<p>Then type<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ssh</span> <span class="selector-tag">-T</span> <span class="selector-tag">git</span>@<span class="keyword">github</span>.<span class="keyword">com</span></span><br></pre></td></tr></table></figure></p>
<p>If show content below,you are successful.</p>
<blockquote>
<p>Hi username! You’ve successfully authenticated, but GitHub does notprovide shell access.</p>
</blockquote>
<p>Then use codes<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hexo g</span></span><br><span class="line"><span class="attribute">hexo d</span></span><br></pre></td></tr></table></figure></p>
<p>if has error like this</p>
<blockquote>
<p>Error deployer not found: git</p>
</blockquote>
<p>please run<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> hexo-deployer-git <span class="comment">--save</span></span><br></pre></td></tr></table></figure></p>
<h1 id="modify-theme"><a href="#modify-theme" class="headerlink" title="modify theme"></a>modify theme</h1><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /home/www/hexo</span><br><span class="line">git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/iissnan/hexo-theme-<span class="keyword">next</span> themes/<span class="keyword">next</span></span><br><span class="line"><span class="keyword">vi</span> _config.yml</span><br><span class="line"># <span class="keyword">change</span> theme: landscape <span class="keyword">to</span> theme: <span class="keyword">next</span></span><br></pre></td></tr></table></figure>
<h1 id="configure-markdown"><a href="#configure-markdown" class="headerlink" title="configure markdown"></a>configure markdown</h1><p>configure markdown to address the conflict between markdown and latex.</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~<span class="regexp">/hexo_blog/node</span>_modules/marked/<span class="class"><span class="keyword">lib</span></span></span><br><span class="line">sudo vim marked.js</span><br></pre></td></tr></table></figure>
<p>replace </p>
<blockquote>
<p>escape: /^\(<a href>\`*{}[\</a># +-.!_&gt;])/,</p>
</blockquote>
<p>to </p>
<blockquote>
<p>escape: /^\(<a href>`*[\</a># +-.!_&gt;])/,</p>
</blockquote>
<p>replace </p>
<blockquote>
<p>em: /^\b_((?:[^_]|__)+?)_\b|^*((?:**|[\s\S])+?)*(?!*)/,</p>
</blockquote>
<p>to</p>
<blockquote>
<p>em:/^*((?:**|[\s\S])+?)*(?!*)/,</p>
</blockquote>
<p>finally </p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hexo g</span></span><br></pre></td></tr></table></figure>
<h1 id="optimization"><a href="#optimization" class="headerlink" title="optimization"></a>optimization</h1><p>You can find related ways from <strong>references</strong></p>
<p>#install dropbox </p>
<ol>
<li><p>create a new user account</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">adduser </span>dbox</span><br><span class="line">passwd dbox</span><br><span class="line"><span class="comment"># print passwd</span></span><br><span class="line">su -l dbox</span><br></pre></td></tr></table></figure>
</li>
<li><p>install dropbox</p>
</li>
</ol>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download dropbox</span></span><br><span class="line"><span class="comment">## 32bit</span></span><br><span class="line"><span class="keyword">cd</span> ~ &amp;&amp; wget -O - <span class="string">"https://www.dropbox.com/download?plat=lnx.x86"</span> | tar xzf -</span><br><span class="line"><span class="comment">## 64bit</span></span><br><span class="line"><span class="keyword">cd</span> ~ &amp;&amp; wget -O - <span class="string">"https://www.dropbox.com/download?plat=lnx.x86_64"</span> | tar xzf -</span><br><span class="line">~<span class="string">/.dropbox-dist/dropboxd</span></span><br><span class="line"><span class="comment"># copy link to chrome and valid</span></span><br><span class="line">wget https:<span class="string">//www.dropbox.com/download</span>?dl=packages/dropbox.py</span><br><span class="line"><span class="comment"># maybe the name of py is not dropbox.py,you only need operate the .py file regardless of its name.</span></span><br><span class="line">chmod +x <span class="string">./dropbox.py</span></span><br><span class="line">~<span class="string">/dropbox.py</span> <span class="keyword">help</span></span><br><span class="line"><span class="comment"># view state</span></span><br><span class="line">~<span class="string">/dropbox.py</span> status</span><br><span class="line"><span class="comment"># start sync</span></span><br><span class="line">~<span class="string">/dropbox.py</span> start</span><br><span class="line"><span class="keyword">cd</span> Dropbox</span><br><span class="line"><span class="comment"># exclude dir which don't need to sync</span></span><br><span class="line">~<span class="string">/dropboxy.py</span> exclude add dirname1 dirname2</span><br><span class="line"><span class="comment"># link the outside folder to the Dropbox folder for syncing</span></span><br><span class="line">ln -s <span class="string">/path/to/desired-folder</span> ~<span class="string">/Dropbox/desired-folder</span></span><br></pre></td></tr></table></figure>
<h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><p><a href="http://renfuheng.com/2016/08/28/%E5%BF%AB%E9%80%9F%E5%9C%A8vps-centOs-6-%E4%B8%8A%E6%90%AD%E5%BB%BAhexo%E5%8D%9A%E5%AE%A2%E5%B9%B6push%E4%B8%80%E4%BB%BD%E5%88%B0github/" target="_blank" rel="noopener">install hexo</a></p>
<p><a href="http://www.jianshu.com/p/0823e387c019" target="_blank" rel="noopener">install git</a></p>
<p><a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">theme next</a></p>
<p><a href="http://www.jianshu.com/p/393d067dba8d" target="_blank" rel="noopener">next theme set preview</a></p>
<p><a href="http://www.wuxubj.cn/2016/08/Hexo-nexT-build-personal-blog/" target="_blank" rel="noopener">add search engine</a></p>
<p><a href="http://www.jianshu.com/p/5d5931289c09" target="_blank" rel="noopener">optimization</a></p>
<p><a href="https://blog.imfer.me/#!/post/2014-04-25-centos-install-dropbox" target="_blank" rel="noopener">install dropbox</a></p>
<p><a href="http://blog.csdn.net/emptyset110/article/details/50123231" target="_blank" rel="noopener">搭建一个支持LaTEX的hexo博客</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/environment/install nodejs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/environment/install nodejs/" class="post-title-link" itemprop="url">install nodejs</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/environment/" itemprop="url" rel="index"><span itemprop="name">environment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>安装nodejs环境。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> ~</span><br><span class="line">curl -sL http<span class="variable">s:</span>//<span class="keyword">deb</span>.nodesource.<span class="keyword">com</span>/setup_6.<span class="keyword">x</span> -<span class="keyword">o</span> nodesource_setup.<span class="keyword">sh</span></span><br><span class="line">sudo bash nodesource_setup.<span class="keyword">sh</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> install nodejs</span><br><span class="line">sudo apt-<span class="built_in">get</span> install build-essential</span><br></pre></td></tr></table></figure>
<h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-16-04" target="_blank" rel="noopener">How To Install Node.js on Ubuntu 16.04</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.muzhen.tk/2019/02/28/development/environment/install ubuntu16.04 on xiaomi AIr/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="muzhen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="the Home of MuZhen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/28/development/environment/install ubuntu16.04 on xiaomi AIr/" class="post-title-link" itemprop="url">install ubuntu16.04 on xiaomi AIr</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-28 20:45:06" itemprop="dateCreated datePublished" datetime="2019-02-28T20:45:06+08:00">2019-02-28</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/environment/" itemprop="url" rel="index"><span itemprop="name">environment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="hardware-environment"><a href="#hardware-environment" class="headerlink" title="hardware environment"></a>hardware environment</h1><p>13.3寸小米笔记本，20176月版，i5-7200u，mx150,8g，256g，指纹识别。</p>
<h1 id="install-ubuntu16-04"><a href="#install-ubuntu16-04" class="headerlink" title="install ubuntu16.04"></a>install ubuntu16.04</h1><p>首先正常安装。有教程提到需要进bios关闭secure boot，我因为是直接装的ubuntu单系统，不存在这个问题。</p>
<p>安装好后，发现如下问题：</p>
<ol>
<li>无线网不能用</li>
<li>蓝牙不能用</li>
<li>指纹识别不能用</li>
<li>双显卡驱动</li>
<li>电池只能支撑4h左右（看视频，文本编辑）</li>
<li>触摸板无法快捷键关闭</li>
</ol>
<p>解决方案如下：</p>
<h2 id="无线网"><a href="#无线网" class="headerlink" title="无线网"></a>无线网</h2><p>编辑blacklist.conf文件：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="keyword">vi</span> /etc/modprobe.d/blacklist.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>
<p>在文件最后加上<code>blacklist acer-wmi</code>，重启即可。</p>
<h2 id="蓝牙"><a href="#蓝牙" class="headerlink" title="蓝牙"></a>蓝牙</h2><p>使用如下命令即可：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="regexp">//mi</span>rrors.kernel.org<span class="regexp">/ubuntu/</span>pool<span class="regexp">/main/</span>l<span class="regexp">/linux-firmware/</span>linux-firmware_1.<span class="number">161.1</span>_all.deb</span><br><span class="line">sudo dpkg -i linux-firmware_1.<span class="number">161.1</span>_all.deb</span><br></pre></td></tr></table></figure>
<p>参考<a href="https://askubuntu.com/questions/881239/bluetooth-not-working-on-xps-13-9360-running-16-04-1" target="_blank" rel="noopener">Bluetooth not working on XPS 13 9360 running 16.04.1</a></p>
<h2 id="指纹识别"><a href="#指纹识别" class="headerlink" title="指纹识别"></a>指纹识别</h2><p>暂未解决</p>
<h2 id="双显卡驱动"><a href="#双显卡驱动" class="headerlink" title="双显卡驱动"></a>双显卡驱动</h2><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装nvidia驱动</span></span><br><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:graphics-drivers/ppa</span><br><span class="line">sudo apt-get update </span><br><span class="line">sudo apt-get install nvidia-384</span><br><span class="line"><span class="comment"># 安装双显卡驱动工具</span></span><br><span class="line">sudo apt-get install nvidia-prime</span><br></pre></td></tr></table></figure>
<p>安装好后启动<code>nvidia x-server settings</code> 切换显卡后注销即可。建议使用核显。</p>
<p>参考<a href="http://www.linuxidc.com/Linux/2016-05/131553.htm" target="_blank" rel="noopener">为Ubuntu 16.04安装Nvidia驱动解决笔记本发热风扇狂转等问题</a></p>
<p>我没有使用参考教程中的ppa仓库，安装好后，并没有在系统托盘中出现nvidia-logo图标。可以使用教程中仓库尝试。</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:mamarley/nvidia</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install nvidia-384 nvidia-prime</span><br></pre></td></tr></table></figure>
<h2 id="电池耗电"><a href="#电池耗电" class="headerlink" title="电池耗电"></a>电池耗电</h2><p>还没有试过只敲代码情况下的电池耐用情况，用过后补充说明。目前来看不够持久，也达不到官方8h标准。</p>
<h2 id="触摸板无法快捷键关闭"><a href="#触摸板无法快捷键关闭" class="headerlink" title="触摸板无法快捷键关闭"></a>触摸板无法快捷键关闭</h2><p>首先，该版本笔记本好像本身就没有提供触摸板快捷键，并非系统问题。</p>
<p>解决方法为自设快捷键。参考<a href="http://blog.csdn.net/hchhbbcxl/article/details/77542975" target="_blank" rel="noopener">小米笔记本12.5英寸装ubuntu后设置快捷键开启和关闭触摸板</a></p>
<ol>
<li><p>使用xinput命令查看设备，并找到触摸板对应设备名称和ID。一般其中带有touchpad单词。注意即使关掉触摸板后指针也无法隐去（我尝试过关闭pointer设备，无效）。具体可以用<code>xinput set-prop （id号） &quot;Device Enabled&quot; 0</code>命令去一个个试出来触摸板对应的id。</p>
</li>
<li><p>编写shell脚本进行操作。</p>
</li>
</ol>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="string">t1=</span>$(<span class="string">xinput </span>| <span class="string">grep </span>‘<span class="string">decive_name’</span>)</span><br><span class="line"><span class="string">t2=</span>$(<span class="string">echo </span>$<span class="string">t1 </span>| <span class="string">sed </span><span class="string">'s/ /\n/g'</span> | <span class="string">grep </span><span class="string">"id"</span>)</span><br><span class="line"><span class="string">res=</span>$&#123;<span class="string">t2#</span><span class="string">"id="</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">var=</span>$(<span class="string">xinput </span><span class="built_in">list-props</span> $<span class="string">res </span>| <span class="string">grep </span><span class="string">"Device Enabled"</span>)</span><br><span class="line"><span class="string">resultv=</span>$&#123;<span class="string">var:</span>(($&#123;<span class="comment">#var&#125;-1))&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">if </span>[ $<span class="string">resultv </span>-<span class="string">eq </span>1 ];<span class="string">then</span></span><br><span class="line"><span class="string">xinput </span><span class="built_in">set-prop</span> $<span class="string">res </span><span class="string">"Device Enabled"</span> 0</span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">xinput </span><span class="built_in">set-prop</span> $<span class="string">res </span><span class="string">"Device Enabled"</span> 1</span><br><span class="line"><span class="string">fi</span></span><br></pre></td></tr></table></figure>
<p>其中，device_name使用设备名称去匹配，不能用id匹配。</p>
<p>将该shell脚本取名为padchange，放到/bin目录下。</p>
<p>在System Setting-&gt;Keyboard-&gt;Shortcuts中设置该脚本的启动快捷键。该脚本的启动命令为’/bin/padchange’。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">muzhen</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">369</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">38</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">114</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">muzhen</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>



  

  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  
  



  




  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  


  

  

  

  

  

  

  

  

  

  

</body>
</html>
